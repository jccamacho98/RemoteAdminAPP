{% extends 'base.html' %}
{% block title %}Monitor{% endblock %}
{% block content %}
    <div class="container">
        <h1>Monitor de PCs</h1>
 <!-- Formulario para listar y actualizar software -->
 <h2>Software Instalado</h2>
 <form method="post">
     {% csrf_token %}
     <div style="margin-bottom: 15px;">
         <label for="selected_pc">Seleccionar PC:</label><br>
         <select name="selected_pc" id="selected_pc" required>
             <option value="">-- Seleccionar PC --</option>
             {% for pc in pcs %}
                 <option value="{{ pc.nombre }}" {% if pc.nombre == selected_pc %}selected{% endif %}>
                     {{ pc.nombre }} ({{ pc.estado }})
                 </option>
             {% endfor %}
         </select>
     </div>
     <button type="submit" name="list_software">Listar Software</button>
     <button type="submit" name="update_software">Actualizar Información</button>
 </form>
 
    <!-- Mostrar lista de software -->
    {% if software_list %}
    <h2>Software Instalado en {{ selected_pc }}:</h2>
    {% if software_list.count > 0 %}
        <table border="1">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Versión</th>
                    <th>Publicador</th>
                    <th>Fecha de Instalación</th>
                    <th>Última Actualización</th>
                </tr>
            </thead>
            <tbody>
                {% for software in software_list %}
                    <tr>
                        <td>{{ software.display_name|default:"No disponible" }}</td>
                        <td>{{ software.display_version|default:"No disponible" }}</td>
                        <td>{{ software.publisher|default:"No disponible" }}</td>
                        <td>{{ software.install_date|default:"No disponible" }}</td>
                        <td>{{ software.last_updated|default:"No disponible" }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No hay software registrado para {{ selected_pc }}. Haz clic en "Actualizar Información" para obtener la lista de software.</p>
    {% endif %}
{% endif %}

<!-- Mostrar mensaje de actualización -->
{% if software_message %}
    <h2>Mensaje:</h2>
    <p>{{ software_message }}</p>
{% endif %}

<!-- Mostrar errores si los hay -->
{% if software_error %}
    <h2>Error:</h2>
    <pre>{{ software_error }}</pre>
{% endif %}
<!--***************************************************************************************************************-->
        <!-- Tabla con la información de los PCs -->
    <h2>Informacion PCs de la Sala 331</h2>         
        <table border="1">
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>IP</th>
                    <th>MAC</th>
                    <th>Sistema Operativo</th>
                    <th>Estado</th>
                    <th>Unido al Dominio</th>
                    <th>Última vez visto</th>
                </tr>
            </thead>
            <tbody>
                {% for pc in pcs %}
                    <tr>
                        <td>{{ pc.nombre }}</td>
                        <td>{{ pc.ip|default:"No disponible" }}</td>
                        <td>{{ pc.mac_address|default:"No disponible" }}</td>
                        <td>{{ pc.sistema_operativo|default:"No disponible" }}</td>
                        <td>{{ pc.estado }}</td>
                        <td>{{ pc.domain_joined|yesno:"Sí,No" }}</td>
                        <td>{{ pc.last_seen|default:"Nunca" }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
         <!-- Botón para actualizar información -->
         <form method="post">
            {% csrf_token %}
            <button type="submit" name="update_info">Actualizar información</button>
        </form>


        <!-- Resultado de la actualización -->
        {% if output %}
            <h2>Resultado de la actualización:</h2>
            <pre>{{ output }}</pre>
        {% endif %}

       
    
    </div>
{% endblock %}